/* native-js-libs - v1.2.2 */
var CanvasGrid,CanvasItem,Draw,canvasHeight,canvasWidth,bind=function(t,i){return function(){return t.apply(i,arguments)}};canvasHeight=500,canvasWidth=500,CanvasItem=function(){function t(t,i,e,n){this._width=t,this._height=i,this._el=document.createElement("CANVAS"),this._ctx=this._el.getContext("2d"),this._el.style.position="absolute",this._top=canvasHeight*n,this._left=canvasWidth*e,this._el.style.top=this._top+"px",this._el.style.left=this._left+"px",this._el.width=this._width,this._el.height=this._height}return t.prototype.draw=function(t,i,e,n){return this._ctx.beginPath(),this._ctx.moveTo(t.x-this._left,t.y-this._top),this._ctx.lineTo(i.x-this._left,i.y-this._top),this._ctx.strokeStyle=e,this._ctx.lineCap="round",this._ctx.lineWidth=n,this._ctx.stroke(),this._ctx.closePath()},t.prototype.erase=function(t,i,e){return this._ctx.save(),this._ctx.globalCompositeOperation="destination-out",this._ctx.beginPath(),this._ctx.moveTo(t.x-this._left,t.y-this._top),this._ctx.lineTo(i.x-this._left,i.y-this._top),this._ctx.lineCap="round",this._ctx.lineWidth=e,this._ctx.stroke(),this._ctx.closePath(),this._ctx.restore()},t.prototype.isTransparent=function(){var t,i,e,n,s,o;for(e=this._ctx.getImageData(0,0,this._width,this._height),o=e.data,i=n=0,s=o.length;n<s;i=n+=4)if(t=o[i],0!==e.data[i+3])return!1;return!0},t.prototype.saveLastStatus=function(){return this.undoImg=this._currentImg,this._currentImg=this._ctx.getImageData(0,0,this._width,this._height),this.redoImg=null},t.prototype.undo=function(){return this.redoImg=this._currentImg,this._ctx.putImageData(this.undoImg,0,0),this.undoImg=null},t.prototype.redo=function(){return this.undoImg=this._ctx.getImageData(0,0,this._width,this._height),this._ctx.putImageData(this.redoImg,0,0),this.redoImg=null},t.prototype.appendTo=function(t){return t.appendChild(this._el)},t.prototype.clear=function(){return this._ctx.clearRect(0,0,this._width,this._height),this.saveLastStatus()},t.prototype.active=function(){return this._el.style.pointerEvents="auto",this._el.style.WebkitUserSelect="none"},t.prototype.inactive=function(){return this._el.style.pointerEvents="none",this._el.style.WebkitUserSelect="auto"},t.prototype.restore=function(t){var i;return this.clear(),i=new Image,i.onload=function(t){return function(){return t._ctx.drawImage(i,0,0),t.saveLastStatus()}}(this),i.src=t},t.prototype.save=function(){return this._el.toDataURL()},t}(),CanvasGrid=function(){function t(t,i){var e,n,s,o,r,a,h,u,d,c;for(this._width=t,this._height=i,this.cols=Math.ceil(this._width/canvasWidth),this.rows=Math.ceil(this._height/canvasHeight),this.grid=[],e=r=0,u=this.cols-1;0<=u?r<=u:r>=u;e=0<=u?++r:--r)for(this.grid[e]=[],h=a=0,d=this.rows-1;0<=d?a<=d:a>=d;h=0<=d?++a:--a)n=canvasHeight,s=canvasWidth,e===this.cols-1&&(c=this._width%canvasWidth,0!==c&&(s=c)),h===this.rows-1&&(o=this._height%canvasHeight,0!==o&&(n=o)),this.grid[e][h]=new CanvasItem(s,n,e,h)}return t.prototype.grid=null,t.prototype._forEach=function(t){var i,e,n,s,o;for(o=[],i=e=0,s=this.cols-1;0<=s?e<=s:e>=s;i=0<=s?++e:--e)o.push(function(){var e,s,o;for(o=[],n=e=0,s=this.rows-1;0<=s?e<=s:e>=s;n=0<=s?++e:--e)o.push(t.call(this,this.grid[i][n]));return o}.call(this));return o},t.prototype.draw=function(t,i,e,n){return this._forEach(function(s){return s.draw(t,i,e,n)})},t.prototype.erase=function(t,i,e){return this._forEach(function(n){return n.erase(t,i,e)})},t.prototype.appendTo=function(t){return this._forEach(function(i){return i.appendTo(t)})},t.prototype.saveLastStatus=function(){return this._forEach(function(t){return t.saveLastStatus()})},t.prototype.undo=function(){return this._forEach(function(t){return t.undo()})},t.prototype.redo=function(){return this._forEach(function(t){return t.redo()})},t.prototype.clearAll=function(){return this._forEach(function(t){return t.clear()})},t.prototype.active=function(){return this._forEach(function(t){return t.active()})},t.prototype.inactive=function(){return this._forEach(function(t){return t.inactive()})},t.prototype.restore=function(t){return this._forEach(function(i){return i.restore(t.shift())})},t.prototype.save=function(t){var i;return i=!0,this._forEach(function(e){return i=i&&e.isTransparent(),t.push(e.save())}),!i},t}(),Draw=function(){function t(){this._drawing=bind(this._drawing,this),this._stopDrawing=bind(this._stopDrawing,this),this._startDrawing=bind(this._startDrawing,this),this.color="black",this.size=12,this._lastXY={},this._currentXY={},this.isErasing=!1,this.isDrawing=!1}return t.prototype.initialize=function(t){var i,e,n,s,o;return o=t.width,i=t.height,s=t.url,n=t.offsetTop,e=t.offsetLeft,this.init(o,i,s,n,e)},t.prototype.init=function(t,i,e,n,s){return null==t&&(t=500),null==i&&(i=500),null==e&&(e=null),this.offsetTop=null!=n?n:0,this.offsetLeft=null!=s?s:0,"object"==typeof t?this.initialize(t):(this.body=document.querySelector("body"),this.div=document.createElement("DIV"),this.div.style.position="absolute",this.div.style.top=(""+this.offsetTop).indexOf("px")!==-1?this.offsetTop:this.offsetTop+"px",this.div.style.left=(""+this.offsetLeft).indexOf("px")!==-1?this.offsetLeft:this.offsetLeft+"px",this.div.style.width=t,this.div.style.height=i,this.div.style.zIndex=9007199254740992,this.canvasGrid=new CanvasGrid(t,i),this.canvasGrid.appendTo(this.div),this.body.appendChild(this.div),this.eventBinding(),this.hide(),this.inactive(),null!=e&&this.restore(e),this.saveLastStatus())},t.prototype.isActive=function(){return"auto"===this.div.style.pointerEvents},t.prototype.active=function(){var t;if(this.div.style.pointerEvents="auto",this.div.style.WebkitUserSelect="none",this.canvasGrid.active(),"undefined"!=typeof GtConfig&&null!==GtConfig?GtConfig.isMobile:void 0)return t=function(){var t;return t=encodeURIComponent(JSON.stringify({method:"disableSwipe"})),window.callGtNative("native://="+t)},window.addGtTask(t)},t.prototype.inactive=function(){var t;if(this.div.style.pointerEvents="none",this.div.style.WebkitUserSelect="auto",this.canvasGrid.inactive(),"undefined"!=typeof GtConfig&&null!==GtConfig?GtConfig.isMobile:void 0)return t=function(){var t;return t=encodeURIComponent(JSON.stringify({method:"enableSwipe"})),window.callGtNative("native://="+t)},window.addGtTask(t)},t.prototype.show=function(){return this.div.style.display="block"},t.prototype.hide=function(){return this.div.style.display="none"},t.prototype.setColor=function(t){this.color=t},t.prototype.setSize=function(t){this.size=t},t.prototype.setEraser=function(t){this.isErasing=t},t.prototype.clearAll=function(){return this.canvasGrid.clearAll()},t.prototype.remove=function(){var t,i;return null!=(t=this.div)&&null!=(i=t.parentElement)?i.removeChild(this.div):void 0},t.prototype.save=function(){var t,i,e;if(i=[],this.canvasGrid.save(i))return e=JSON.stringify(i),("undefined"!=typeof GtConfig&&null!==GtConfig?GtConfig.isMobile:void 0)&&(t=function(){var t;return t=encodeURIComponent(JSON.stringify({method:"saveCanvas",params:{url:e}})),window.callGtNative("native://="+t)},window.addGtTask(t)),e},t.prototype.restore=function(t){return t=JSON.parse(t),this.canvasGrid.restore(t)},t.prototype.whenUpdate=function(){},t.prototype.saveLastStatus=function(){return this.canvasGrid.saveLastStatus(),this.sendUndoRedo(),this.whenUpdate()},t.prototype.undo=function(){return this.canvasGrid.undo(),this.sendUndoRedo()},t.prototype.redo=function(){return this.canvasGrid.redo(),this.sendUndoRedo()},t.prototype.sendUndoRedo=function(){var t;if("undefined"!=typeof GtConfig&&null!==GtConfig?GtConfig.isMobile:void 0)return t=function(t){return function(){var i;return i=encodeURIComponent(JSON.stringify({method:"drawUndoRedo",params:{undo:t.isUndoPossible(),redo:t.isRedoPossible()}})),window.callGtNative("native://="+i)}}(this),window.addGtTask(t)},t.prototype.isUndoPossible=function(){return Boolean(this.canvasGrid.grid[0][0].undoImg)},t.prototype.isRedoPossible=function(){return Boolean(this.canvasGrid.grid[0][0].redoImg)},t.prototype._getXY=function(t){var i,e;return("undefined"!=typeof GtConfig&&null!==GtConfig?GtConfig.isMobile:void 0)?(e=t.changedTouches[0],i={x:e.pageX-this.offsetLeft,y:e.pageY-this.offsetTop}):i={x:t.pageX-this.offsetLeft,y:t.pageY-this.offsetTop},i},t.prototype._startDrawing=function(t){return t.preventDefault(),this._lastXY=this._getXY(t),this.isDrawing=!0},t.prototype._stopDrawing=function(t){if(this.isDrawing)return t.preventDefault(),this.isDrawing=!1,this.saveLastStatus()},t.prototype._drawing=function(t){if(this.isDrawing)return t.preventDefault(),this._currentXY=this._getXY(t),this.isErasing?this._erase():this._draw(),this._lastXY=this._currentXY},t.prototype._draw=function(){return this.canvasGrid.draw(this._lastXY,this._currentXY,this.color,this.size)},t.prototype._erase=function(){return this.canvasGrid.erase(this._lastXY,this._currentXY,this.size)},t.prototype.eventBinding=function(){return("undefined"!=typeof GtConfig&&null!==GtConfig?GtConfig.isMobile:void 0)?(this.div.addEventListener("touchstart",this._startDrawing),this.div.addEventListener("touchmove",this._drawing),this.div.addEventListener("touchend",this._stopDrawing)):(this.div.addEventListener("mousedown",this._startDrawing),this.div.addEventListener("mousemove",this._drawing),this.div.addEventListener("mouseup",this._stopDrawing),this.div.addEventListener("mouseout",function(t){return function(i){var e;if(null!=(e=i.toElement)&&e.parentElement!==t.div)return t._stopDrawing(i)}}(this)))},t}(),window.Draw=new Draw;